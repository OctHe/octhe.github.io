@node Distribution
@chapter Distribution

Linux contains lots of well-known distributions.
A Linux distribtuion comprises multiple drivers to support different hardware architectures and a collections of softwares in the user sapce.
The follow tables summarize the main different between these awesome distributions and the programs.

@multitable @columnfractions .1 .18 .18 .18 .18 .18
@headitem             @tab    Arch   @tab      Debian      @tab  openSUSE @tab   Fedora  @tab   NixOS   
@item Default desktop @tab     -     @tab       GNOME      @tab    KDE    @tab   GNOME   @tab   GNOME   
@item   Init system   @tab  systemd  @tab      systemd     @tab  systemd  @tab  systemd  @tab  systemd  
@item Package manager @tab   pacman  @tab        apt       @tab   zypper  @tab    dnf    @tab    Nix    
@item    C library    @tab   glibc   @tab       glibc      @tab   glibc   @tab   glibc   @tab   glibc   
@item     Utility     @tab coreutils @tab     coreutils    @tab coreutils @tab coreutils @tab coreutils 
@item    Installer    @tab    CLI    @tab Debian-Installer @tab    YaST   @tab  Anaconda @tab Calamares 
@end multitable

@multitable @columnfractions .1 .3 .3 .3
@headitem             @tab    Void   @tab  Alpine @tab      Deepin      
@item Default desktop @tab    xfce   @tab    -    @tab        DDE       
@item   Init system   @tab   runit   @tab  OpenRC @tab      systemd     
@item Package manager @tab    xbps   @tab   apk   @tab         -        
@item    C library    @tab    musl   @tab   musl  @tab       glibc      
@item     Utility     @tab coreutils @tab Busybox @tab     coreutils    
@item    Installer    @tab    CLI    @tab   CLI   @tab deepin-installer 
@end multitable

@section Package Manager

The follow lists common package managers that in different distributions.
@itemize @bullet
@item apt
@item zypper
@item dnf
@item pacman
@item Flatpak
@item AppImage
@end itemize

@subsection zypper

openSUSE uses @code{zypper} as the default package manager.
It is based on RPM, which is similar to Fedora.
Besides installation of the built programs, zypper also provides an offical repository for the source code.
As an example, the download and build process for the @code{hostapd} is

@code{sudo zypper source-install hostapd}
@code{# or `sudo zypper si hostapd`}
@code{cd /usr/src/packages/       # cd to the default directory for source code}
@code{ls SOURCES}
@code{ls SPECS}
@code{sudo zypper in rpmbuild     # The build tool of the download source code}
@code{sudo rpmbuild -ba SPECS/hostapd.spec}
@code{                            # -ba means to perform a full build. }
@code{ls RPMS/x86_64              # The built program in the x86 architecture}
@code{sudo rpmbuild -ba --noclean SPECS/hostapd.spec}
@code{                            # It does not remove the extracted source code}
@code{ls BUILD                    # The extracted source code}

However, openSUSE also provides a command-line tool for package download, building and packaging.
The name of the tool is osc, which means openSUSE commander.
To use it, run

@code{sudo zypper install osc}

@subsection Flatpak

Flatpak is a cross-platform package manager that run applications in a sandbox.
It can download apps from FlatHub, which is the official repository of Flatpak.

@code{flatpak install <package name/ID>}

Different from apt/zypper/dnf/pacman, you cannot run the applications from flatpak directly.

@code{flatpak run <package name/ID>}

@section Init Process

In Linux, the first process is usually *init* or *systemd*.
They both work to manage the initialization of the system before the login shell.
The PID of them is 1, which means the first process after the kernel.

@subsection System V and init

init is the initial script in System V project.
In a early version of a Linux distribution, it usually uses init as the initalization system.
It finds the configuration file in @code{/etc/inittab} and runs the scripts in @code{/etc/rc} according to the runlevel.
Different runlevels means different modes of init.
It will run the corresponding runlevel scripts in @code{/etc/rcN.d/}, where N means the runlevel.
The value of N is from 0 to 6.
All scripts under these directories are a symbolic link to a file in @code{etc/init.d/}.
The file started with "S" means "start it", while "K" means "kill it".
The feature of init is run all script in a fixed order one-by-one, so it is easy to find the error, while costs lots of time.

@subsection systemd

In contrast, systemd concurrently runs all scripts.
Ubuntu and OpenSUSE have been support systemd and their would have other distributions.
In a system that initialized with systemd.
The init file, which is @code{/usr/sbin/init} will be a symbolic to the @code{/lib/systemd/systemd}.
The default configuration file of systemd is @code{/usr/lib/systemd/system/default.target}, which is also a symbolic link to @code{/usr/lib/systemd/system/graphical.target}.
You can find the default target with

@code{systemctl get-default}

@section Linux To Go

Linux To Go (LTG) is a method to install Linux in external USB disk.
The main advantage of LTG is to boot your owe system in multiple computers that have same architecture (for example, x86 system).

The LTG is based on Fedora since it has stable version, so it does not need to be updated frequently.
The boot method is UEFI, so allocate a partition with 1 GiB to support UEFI.
In addition, install the bootloader to the USB disk.
After that, the installation process is the same as a normal installation in any disk.

@section Multi-OS Installation

Install multiple OSs is simple since lots-of OSs have a GUI installer.
In most time, someone does not need to install the OS in the hardware, if he only want to try it at first.
This section summarizes the content about Live USB and Disk layout.

@subsection Live USB

The first thing of installation OSs is having a Live USB that contains multiple ISOs.
@url{https://www.ventoy.net/en/index.html, Vectoy} is an open-source tool that can load multiple Live USBs
The USB with Ventoy also can be used for backup files.

The only drawback of ventoy is the grub may have a incorrect boot configuration.
This makes the installed OS can be boot with recovery mode but cannot boot with the normal mode.
To avoid this, just edit the grub (type `e` when boot) and delete the command `rdinit=/vtoy/vtoy`.

@subsection Disk Partition

Most Linux distributions provides a GUI installer, so the installation is quite easy.
The only thing worth noting is carefully about the disk partition without formating the partition and lossing data.
Usually, all the home directories of all OSs can be listed in the same partition with different folders.
An example partition can be as follows

@itemize @bullet
@item nvme0n1
    @itemize @minus
    @item nvme0n1p1 (512 MB)
        @itemize @minus
        @item /boot/efi
        @end itemize
    @item nvme0n1p2 (16 GB)
        @itemize @minus
        @item /swap
        @end itemize
    @item nvme0n1p3 (500 GB)
        @itemize @minus
        @item /home
            @itemize @minus
            @item /home/user_ubuntu
            @item /home/user_suse
            @item /home/user_arch
            @item ... 
            @end itemize
        @end itemize
    @item nvme0n1p4 (100 GB)
        @itemize @minus
        @item /       # root for Ubuntu
        @end itemize
    @item nvme0n1p5 (100 GB)
        @itemize @minus
        @item /       # root for OpenSUSE
        @end itemize
    @item ...
    @end itemize
@end itemize

The most important thing is: DON'T FORMAT the home directory in nvme0n1p3 and the /boot/efi directory in nvme0n1p1 when install a new OS.
This partition can provide the capability to reinstall all OSs without affecting the user data.

@subsection Update grub

After a new installation, it is better to update the grub at any OSs.
The follow command can be used only once at one of the OSs.
In Debian, use
    
@code{sudo grub-mkconfig -o /boot/grub/grub.cfg}
@code{sudo grub-install /nvme0n1}

In OpenSUSE, use
    
@code{sudo grub2-mkconfig -o /boot/grub/grub.cfg}
@code{sudo grub2-install /nvme0n1}

@subsection Reinstallation

Most time there is no need to reinstall my OSs, but sometimes the OS cannot be boot due to strange issues.
In this time, the OS can be reinstalled with the same partition and user name as the old version.
For example, the root of the new ubuntu will be listed in nvme0n1p4, and the /home will be listed in nvme01n1p3.
The user name is 'user_ubuntu', so the configuration of the old OS can be reused for the new OS.

@node Desktop Enviornment
@chapter Desktop Environment

A Linux distribution usually has two types of interfaces.
One of them is virtual console (CLI) and the other is GUI.
Virtual console is the default interface from Linux kernel and does not support Unicode.
For example, in Debian/Ubuntu, type @code{<ctrl>+<alt>+F@{1-6@}} can change between virtual console and GUI.
Specifically, @code{<ctrl>+<alt>+F2} can change to the GUI, and @code{<ctrl>+<alt>+F@{3,4,5,6@}} are different virtual consoles.
Desktop environment is a collection of GUI programs that replaces CLI and is one of the most complicated subsystem in Linux.
It breaks up the limitation of shell and provides a more flexiable interface for users.
By default, the startup program, i.e., systemd, will initialize the GUI desktop.
The desktop also can be opened manually. 
For example, @code{sudo startx} is the command to start an x11 service.
x11 and Wayland are two communication protocol that relates a display server and the client.
Most of the desktop and libraries are based on them.

Graphicless compares the follow open-source desktop environments.

@multitable @columnfractions .25 .25 .25 .25
@headitem              @tab        KDE         @tab       GNOME       @tab         xfce
@item      Toolkit     @tab         QT         @tab        GTK        @tab         GTK
@item  Display manager @tab        SDDM        @tab        gdm        @tab       LightDM
@item  Session manager @tab      ksmserver     @tab   gnome-session   @tab    xfce4-session
@item  Windows manager @tab        KWin        @tab    gnome-shell    @tab        xfwm4
@item  Desktop manager @tab          -         @tab         -         @tab      xfdesktop
@item   File manager   @tab       Dolphin      @tab     Nautilus      @tab        Thunar
@item     Launcher     @tab       Kickoff      @tab         -         @tab      xfce-panel
@item      Editor      @tab        Kate        @tab gnome-text-editor @tab       Mousepad
@item     Terminal     @tab       Konsole      @tab   gnome-terminal  @tab    xfce4-terminal
@item      Network     @tab   Network Manager  @tab  Network Manager  @tab          -
@item     Capturer     @tab      Spectacle     @tab  GNOME Screenshot @tab xfce4-screenshooter
@item  Document viewer @tab       Okular       @tab       Evince      @tab          -
@item   Image viewer   @tab      Gwenview      @tab       Loupe       @tab      Ristretto
@item   Input method   @tab          -         @tab         -         @tab          -
@item Advanced setting @tab          -         @tab    gnome-tweaks   @tab          -
@item    Development   @tab      KDevelop      @tab   GNOME Builder   @tab          -
@end multitable

@multitable @columnfractions .2 .4 .4
@headitem                   @tab    LXQT      @tab         DDE
@item      Toolkit          @tab      QT      @tab          QT
@item  Display manager      @tab     SDDM     @tab       LightDM
@item  Session manager      @tab lxqt-session @tab     dde-session
@item  Windows manager      @tab    Openbox   @tab     deepin-kwin
@item  Desktop manager      @tab       -      @tab          -
@item   File manager        @tab  PcManFm-qt  @tab   dde-file-manager
@item     Launcher          @tab  lxqt-runner @tab     dde-launcher
@item      Editor           @tab       -      @tab    deepin-editor
@item     Terminal          @tab   QTerminal  @tab   deepin-terminal
@item      Network          @tab       -      @tab          -
@item     Capturer          @tab  Screengrab  @tab  deepin-screenshot
@item  Document viewer      @tab       -      @tab    deepin-reader
@item   Image viewer        @tab  Lximage-qt  @tab deepin-image-viewer
@item   Input method        @tab       -      @tab      deepin-im 
@item Advanced setting      @tab       -      @tab     deepin-tweak
@item    Development        @tab       -      @tab      Deepin-IDE
@end multitable

@section GNOME

@subsection Advanced Setting

gnome-tweaks gives advanced settings for gnome.
It support swap of Caplock and Ctrl.
Download it in Debian with

@code{sudo apt install gnome-tweaks}

This swap is only useful in gnome-based GUI.
Windows has a similar tool that named as [PowerToys](https://github.com/microsoft/PowerToys).

@section xfce4

Graphicless tests xfce4 in Debian 12.
It uses xfce4-terminal and firefox as the default applications for terminal and web browser, respectively.

@section Window Manager

@multitable @columnfractions .2 .2 .2 .2 .2
@headitem @tab Openbox @tab i3 @tab xmonad @tab sway
@item Protocol @tab x11 @tab x11 @tab Wayland @tab Wayland
@end multitable

@subsection Openbox

Install Openbox with apt

@code{sudo apt install openbox}

By default, openbox has a refresh issue in Ubuntu.
The applications will not automatic refresh after opening them.
To fix this, change the configuration file

@code{sudo vim /usr/lib/x86_64-linux-gnu/openbox-autostart}

Uncommand the line 
@code{test -z $BG || $BG -solid "#303030"}

